kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F)
#Modelo 2 con logaritmos
modelo2=lm(data=datos, I(log(bpsystol)) ~ bmi + sex + age)
#summary(modelo2)
#stargazer(modelo2)
stargazer(modelo1, modelo2)
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F, title(Pruebas))
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F, title("Pruebas"))
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F, title="Pruebas")
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F)
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F, header_text="oso")
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F, header="oso")
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F, label="oso")
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F)
AIC(modelo1)
AIC(modelo1)
AIC(modelo2)
AIC(modelo1)
AIC(modelo2)
AIC(modelo1)
AIC(modelo2)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stargazer)
library(kableExtra)
library(flextable)
library(performance)
library(see)
library(lmtest)
library(qqplotr)
library(ggrepel)
library(patchwork)
library(boot)
library(rempsyc)
library(report)
datos<-read_csv("Preg1B.csv", show_col_types = FALSE)
datos$sex<-factor(datos$sex) #declaramos la variable como factor
#Realizamos un relevel para poner como referencia "1" hombre
datos$sex<-relevel(datos$sex,"1")
modelo1<-lm(data=datos, bpsystol ~ bmi + sex + age)
#summary(modelo1)
table_tests<-nice_assumptions(modelo1)
table_tests_fin<-subset(table_tests, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin)) %>%
kable_styling(bootstrap_options = "striped", full_width = F)
#Modelo 2 con logaritmos
modelo2=lm(data=datos, I(log(bpsystol)) ~ bmi + sex + age)
#summary(modelo2)
#stargazer(modelo1, modelo2)
par(mfrow = c(2, 2))
#####check_model() function of performance package: Graphs####
# return a list of single plots
diagnostic_plots <- plot(check_model(modelo2, panel = FALSE))
# linearity
diagnostic_plots[[2]]
# normally distributed residuals
diagnostic_plots[[6]]
# homoscedasticiy - homogeneity of variance
diagnostic_plots[[3]]
# influential observations - outliers
diagnostic_plots[[4]]
###check_model function of performance package: p-values ###
#check_collinearity(modelo1) # VIF
#check_autocorrelation(modelo1) #  Autocorrelated residuals p value
#check_heteroscedasticity(modelo1) # non-constant error variance (heteroscedasticity): p value
#check_outliers(modelo1) # Outliers method and threshold: cook
# check_normality(modelo1) # Normality of residuals p value
# nice_assumptions() function of  rempsyc package: table
table_tests2<-nice_assumptions(modelo2)
table_tests_fin2<-subset(table_tests2, select = -c(Model,Diagnostic) )
kable(t(table_tests_fin2)) %>%
kable_styling(bootstrap_options = "striped", full_width = F)
#Las AIC no son comparables directamente por la transformación hecha
#AICmodelo1<-AIC(modelo1)
#AICmodelo2<-AIC(modelo2)
#La primera prueba que se debe realizar es
#prueba asociada a la tabla ANOVA de regresión lineal múltiple
library(multcomp)
K=matrix(c(0,1,0,0), ncol=4, nrow=1)
m=0
prueba_dir<-glht(modelo2, linfct=K, rhs=m, alternative ="greater")
#summary(prueba_dir)
# Se rechaza H0, lo que implica que se puede proceder
# al análisis del modelo
curva_ajustada_mujer30 <- function(x) {exp(modelo2$coefficients[1] + modelo2$coefficients[2]*x + modelo2$coefficients[3] + modelo2$coefficients[4]*30)}
curva_ajustada_hombre30 <- function(x) {exp(modelo2$coefficients[1] + modelo2$coefficients[2]*x  + modelo2$coefficients[4]*30)}
curva_ajustada_mujer50 <- function(x) {exp(modelo2$coefficients[1] + modelo2$coefficients[2]*x + modelo2$coefficients[3] + modelo2$coefficients[4]*50)}
curva_ajustada_hombre50 <- function(x) {exp(modelo2$coefficients[1] + modelo2$coefficients[2]*x  + modelo2$coefficients[4]*50)}
curva_ajustada_mujer64 <- function(x) {exp(modelo2$coefficients[1] + modelo2$coefficients[2]*x + modelo2$coefficients[3] + modelo2$coefficients[4]*64)}
curva_ajustada_hombre64 <- function(x) {exp(modelo2$coefficients[1] + modelo2$coefficients[2]*x  + modelo2$coefficients[4]*64)}
ggplot(datos, aes(bmi, bpsystol)) +
geom_point() +
geom_function(fun = curva_ajustada_mujer30, aes(linetype = "mujer de 30") ,col="skyblue", lwd = 1) +
geom_function(fun = curva_ajustada_hombre30, aes(linetype = "hombre de 30") ,col="green") +
geom_function(fun = curva_ajustada_mujer50, aes(linetype = "mujer de 50") ,col="darkblue", lwd = 0.8) +
geom_function(fun = curva_ajustada_hombre50, aes(linetype = "hombre de 50") ,col="darkgreen") +
geom_function(fun = curva_ajustada_mujer64, aes(linetype = "mujer de 64") ,col="red") +
geom_function(fun = curva_ajustada_hombre64, aes(linetype = "hombre de 64") ,col="magenta") + theme_bw()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stargazer)
library(kableExtra)
datos<-read_csv("https://raw.githubusercontent.com/LeobardoEnriquezH/Data/main/Preg3B.csv", show_col_types = FALSE)
datos$Insecticide<-factor(datos$Insecticide) #declaramos la variable como factor
#Realizamos un relevel para poner como referencia "1"
datos$Insecticide<-relevel(datos$Insecticide,"A")
#Creamos dato de proporcion de insectos que mueren
datos$p_Killed<-datos$Killed/datos$Number
ggplot(data=datos, aes(x=Deposit,y=p_Killed, colour=Insecticide))+ geom_point()+ theme_bw()+
theme(text = element_text(size = 11),element_line(linewidth =0.5))
#Convertimos a datos desagrupados (más común en la práctica)
#library(tidyverse)
datos$NoKilled<-datos$Number-datos$Killed
datna_1=datos %>% group_by(Killed,Insecticide,Deposit) %>%
do( data.frame(died= rep(1, .$Killed)))
datna_2=datos %>% group_by(Killed,Insecticide,Deposit) %>%
do( data.frame(died= rep(0, .$NoKilled)))
datna<-rbind(datna_1,datna_2)
#Generar variables con datos en logaritmos
datna$lnD=log(datna$Deposit)
#datos$lnD=factor(datos$lnD) #declaramos la variable como factor
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit=glm(died~Insecticide*lnD, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob=glm(died~Insecticide*lnD, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll=glm(died~Insecticide*lnD, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit_s=glm(died~Insecticide+lnD, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob_s=glm(died~Insecticide+lnD, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll_s=glm(died~Insecticide+lnD, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#stargazer(fitlogit, fitprob, fitcll, fitlogit_s, fitprob_s, fitcll_s)
#A continuación se muestran los valores AIC y BIC, respectivamente, para las ligas logit, probit y cloglog. Como se mencinó anteriormente, se elige el modelo con el menor AIC, que es el de la liga probit.
#Además con el modelo completo también los criterios AIC y BIC coinciden
# ("AIC:logit probit cloglog")
# c(AIC(fitlogit), AIC(fitprob),  AIC(fitcll))
# ("BIC:logit probit cloglog")
# c(BIC(fitlogit), BIC(fitprob), BIC(fitcll))
#La primera prueba que se debe realizar es
#la similar a la prueba asociada a la tabla ANOVA en regresión lineal múltiple
library(multcomp)
K=matrix(c(0,1,0,0,
0,0,1,0,
0,0,0,1), ncol=4, nrow=3, byrow=TRUE)
m=c(0,0,0)
summary(glht(fitprob_s, linfct=K, rhs=m), test=Chisqtest())  #Chisqtest() es apropiada para datos donde y no es continua
# Se rechaza H0, lo que implica que se puede proceder
# al análisis del modelo
datna$lnD2=datna$lnD*datna$lnD
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#stargazer(fitlogit, fitprob, fitcll, fitlogit_s, fitprob_s, fitcll_s)
#Además con el modelo completo también los criterios AIC y BIC coinciden
# ("AIC:logit probit cloglog")
# c(AIC(fitlogit), AIC(fitprob),  AIC(fitcll))
# ("BIC:logit probit cloglog")
# c(BIC(fitlogit), BIC(fitprob), BIC(fitcll))
#La primera prueba que se debe realizar es
#la similar a la prueba asociada a la tabla ANOVA en regresión lineal múltiple
library(multcomp)
K=matrix(c(0,1,0,0,0,
0,0,1,0,0,
0,0,0,1,0,
0,0,0,0,1), ncol=5, nrow=4, byrow=TRUE)
m=c(0,0,0,0)
summary(glht(fitprob_s, linfct=K, rhs=m), test=Chisqtest())  #Chisqtest() es apropiada para datos donde y no es continua
# Se rechaza H0, lo que implica que se puede proceder
# al análisis del modelo
# Se incluye cierta aleatorización para datos binarios
library(statmod)
fitlogitqr <- qresid(fitprob_s)
#qqnorm( fitlogitqr, las=1 ); qqline( fitlogitqr)
lilKS<-nortest::lillie.test(fitlogitqr)
Shapiro<-shapiro.test(fitlogitqr)
library(DHARMa)  #Los residuales simulados también son útiles en este caso
set.seed(123)
fitprobitres <- simulateResiduals(fittedModel = fitprob_s)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stargazer)
library(kableExtra)
datos<-read_csv("https://raw.githubusercontent.com/LeobardoEnriquezH/Data/main/Preg3B.csv", show_col_types = FALSE)
datos$Insecticide<-factor(datos$Insecticide) #declaramos la variable como factor
#Realizamos un relevel para poner como referencia "1"
datos$Insecticide<-relevel(datos$Insecticide,"A")
#Creamos dato de proporcion de insectos que mueren
datos$p_Killed<-datos$Killed/datos$Number
ggplot(data=datos, aes(x=Deposit,y=p_Killed, colour=Insecticide))+ geom_point()+ theme_bw()+
theme(text = element_text(size = 11),element_line(linewidth =0.5))
#Convertimos a datos desagrupados (más común en la práctica)
#library(tidyverse)
datos$NoKilled<-datos$Number-datos$Killed
datna_1=datos %>% group_by(Killed,Insecticide,Deposit) %>%
do( data.frame(died= rep(1, .$Killed)))
datna_2=datos %>% group_by(Killed,Insecticide,Deposit) %>%
do( data.frame(died= rep(0, .$NoKilled)))
datna<-rbind(datna_1,datna_2)
#Generar variables con datos en logaritmos
datna$lnD=log(datna$Deposit)
#datos$lnD=factor(datos$lnD) #declaramos la variable como factor
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit=glm(died~Insecticide*lnD, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob=glm(died~Insecticide*lnD, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll=glm(died~Insecticide*lnD, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit_s=glm(died~Insecticide+lnD, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob_s=glm(died~Insecticide+lnD, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll_s=glm(died~Insecticide+lnD, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#stargazer(fitlogit, fitprob, fitcll, fitlogit_s, fitprob_s, fitcll_s)
#A continuación se muestran los valores AIC y BIC, respectivamente, para las ligas logit, probit y cloglog. Como se mencinó anteriormente, se elige el modelo con el menor AIC, que es el de la liga probit.
#Además con el modelo completo también los criterios AIC y BIC coinciden
# ("AIC:logit probit cloglog")
# c(AIC(fitlogit), AIC(fitprob),  AIC(fitcll))
# ("BIC:logit probit cloglog")
# c(BIC(fitlogit), BIC(fitprob), BIC(fitcll))
#La primera prueba que se debe realizar es
#la similar a la prueba asociada a la tabla ANOVA en regresión lineal múltiple
library(multcomp)
K=matrix(c(0,1,0,0,
0,0,1,0,
0,0,0,1), ncol=4, nrow=3, byrow=TRUE)
m=c(0,0,0)
summary(glht(fitprob_s, linfct=K, rhs=m), test=Chisqtest())  #Chisqtest() es apropiada para datos donde y no es continua
# Se rechaza H0, lo que implica que se puede proceder
# al análisis del modelo
datna$lnD2=datna$lnD*datna$lnD
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#stargazer(fitlogit, fitprob, fitcll, fitlogit_s, fitprob_s, fitcll_s)
#Además con el modelo completo también los criterios AIC y BIC coinciden
# ("AIC:logit probit cloglog")
# c(AIC(fitlogit), AIC(fitprob),  AIC(fitcll))
# ("BIC:logit probit cloglog")
# c(BIC(fitlogit), BIC(fitprob), BIC(fitcll))
#La primera prueba que se debe realizar es
#la similar a la prueba asociada a la tabla ANOVA en regresión lineal múltiple
library(multcomp)
K=matrix(c(0,1,0,0,0,
0,0,1,0,0,
0,0,0,1,0,
0,0,0,0,1), ncol=5, nrow=4, byrow=TRUE)
m=c(0,0,0,0)
summary(glht(fitprob_s, linfct=K, rhs=m), test=Chisqtest())  #Chisqtest() es apropiada para datos donde y no es continua
# Se rechaza H0, lo que implica que se puede proceder
# al análisis del modelo
# Se incluye cierta aleatorización para datos binarios
library(statmod)
fitlogitqr <- qresid(fitprob_s)
#qqnorm( fitlogitqr, las=1 ); qqline( fitlogitqr)
lilKS<-nortest::lillie.test(fitlogitqr)
Shapiro<-shapiro.test(fitlogitqr)
library(DHARMa)  #Los residuales simulados también son útiles en este caso
set.seed(123)
fitprobitres <- simulateResiduals(fittedModel = fitprob_s)
deviance_df<-deviance(fitprob_s)/df.residual(fitprob_s)
library(DHARMa)  #Los residuales simulados también son útiles en este caso
set.seed(123)
fitprobitres <- simulateResiduals(fittedModel = fitprob_s)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stargazer)
library(kableExtra)
datos<-read_csv("https://raw.githubusercontent.com/LeobardoEnriquezH/Data/main/Preg3B.csv", show_col_types = FALSE)
datos$Insecticide<-factor(datos$Insecticide) #declaramos la variable como factor
#Realizamos un relevel para poner como referencia "1"
datos$Insecticide<-relevel(datos$Insecticide,"A")
#Creamos dato de proporcion de insectos que mueren
datos$p_Killed<-datos$Killed/datos$Number
ggplot(data=datos, aes(x=Deposit,y=p_Killed, colour=Insecticide))+ geom_point()+ theme_bw()+
theme(text = element_text(size = 11),element_line(linewidth =0.5))
#Convertimos a datos desagrupados (más común en la práctica)
#library(tidyverse)
datos$NoKilled<-datos$Number-datos$Killed
datna_1=datos %>% group_by(Killed,Insecticide,Deposit) %>%
do( data.frame(died= rep(1, .$Killed)))
datna_2=datos %>% group_by(Killed,Insecticide,Deposit) %>%
do( data.frame(died= rep(0, .$NoKilled)))
datna<-rbind(datna_1,datna_2)
#Generar variables con datos en logaritmos
datna$lnD=log(datna$Deposit)
#datos$lnD=factor(datos$lnD) #declaramos la variable como factor
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit=glm(died~Insecticide*lnD, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob=glm(died~Insecticide*lnD, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll=glm(died~Insecticide*lnD, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit_s=glm(died~Insecticide+lnD, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob_s=glm(died~Insecticide+lnD, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll_s=glm(died~Insecticide+lnD, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#stargazer(fitlogit, fitprob, fitcll, fitlogit_s, fitprob_s, fitcll_s)
#A continuación se muestran los valores AIC y BIC, respectivamente, para las ligas logit, probit y cloglog. Como se mencinó anteriormente, se elige el modelo con el menor AIC, que es el de la liga probit.
#Además con el modelo completo también los criterios AIC y BIC coinciden
# ("AIC:logit probit cloglog")
# c(AIC(fitlogit), AIC(fitprob),  AIC(fitcll))
# ("BIC:logit probit cloglog")
# c(BIC(fitlogit), BIC(fitprob), BIC(fitcll))
#La primera prueba que se debe realizar es
#la similar a la prueba asociada a la tabla ANOVA en regresión lineal múltiple
library(multcomp)
K=matrix(c(0,1,0,0,
0,0,1,0,
0,0,0,1), ncol=4, nrow=3, byrow=TRUE)
m=c(0,0,0)
summary(glht(fitprob_s, linfct=K, rhs=m), test=Chisqtest())  #Chisqtest() es apropiada para datos donde y no es continua
# Se rechaza H0, lo que implica que se puede proceder
# al análisis del modelo
datna$lnD2=datna$lnD*datna$lnD
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll=glm(died~Insecticide*lnD+Insecticide*lnD2, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#En general hay 4 ligas que se podrían usar para covariables factores: logit, probit, cloglog y log.
#Aqui emplearemos 3 ligas porque tenemos una variable numérica entre las covariables, omitimos liga log.
fitlogit_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="logit"), data=datna)
#summary(fitlogit)
fitprob_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="probit"), data=datna)
#summary(fitprob)
fitcll_s=glm(died~Insecticide+lnD +lnD2, family = binomial(link="cloglog"), data=datna)
#summary(fitcll)
#stargazer(fitlogit, fitprob, fitcll, fitlogit_s, fitprob_s, fitcll_s)
#Además con el modelo completo también los criterios AIC y BIC coinciden
# ("AIC:logit probit cloglog")
# c(AIC(fitlogit), AIC(fitprob),  AIC(fitcll))
# ("BIC:logit probit cloglog")
# c(BIC(fitlogit), BIC(fitprob), BIC(fitcll))
#La primera prueba que se debe realizar es
#la similar a la prueba asociada a la tabla ANOVA en regresión lineal múltiple
library(multcomp)
K=matrix(c(0,1,0,0,0,
0,0,1,0,0,
0,0,0,1,0,
0,0,0,0,1), ncol=5, nrow=4, byrow=TRUE)
m=c(0,0,0,0)
summary(glht(fitprob_s, linfct=K, rhs=m), test=Chisqtest())  #Chisqtest() es apropiada para datos donde y no es continua
# Se rechaza H0, lo que implica que se puede proceder
# al análisis del modelo
# Se incluye cierta aleatorización para datos binarios
library(statmod)
fitlogitqr <- qresid(fitprob_s)
#qqnorm( fitlogitqr, las=1 ); qqline( fitlogitqr)
lilKS<-nortest::lillie.test(fitlogitqr)
Shapiro<-shapiro.test(fitlogitqr)
library(DHARMa)  #Los residuales simulados también son útiles en este caso
set.seed(123)
fitprobitres <- simulateResiduals(fittedModel = fitprob_s)
View(datos)
View(datna)
View(datos)
curva_ajustada_A <- function(x) {fitprob_s$coefficients[1] + fitprob_s$coefficients[4]*log(x) + fitprob_s$coefficients[5]*log(x)*log(x)}
curva_ajustada_B <- function(x) {fitprob_s$coefficients[1] + fitprob_s$coefficients[2] + fitprob_s$coefficients[4]*log(x) + fitprob_s$coefficients[5]*log(x)*log(x)}
curva_ajustada_C <- function(x) {fitprob_s$coefficients[1] + fitprob_s$coefficients[3] + fitprob_s$coefficients[4]*log(x) + fitprob_s$coefficients[5]*log(x)*log(x)}
ggplot(datos, aes(Deposit, bp_Killed)) +
geom_point() +
geom_function(fun = curva_ajustada_A, aes(linetype = "Insecticida A") ,col="skyblue", lwd = 1) +
geom_function(fun = curva_ajustada_B, aes(linetype = "Insecticida B") ,col="green") +
geom_function(fun = curva_ajustada_C, aes(linetype = "Insecticida C") ,col="darkblue", lwd = 0.8)+ theme_bw()
ggplot(datos, aes(Deposit, p_Killed)) +
geom_point() +
geom_function(fun = curva_ajustada_A, aes(linetype = "Insecticida A") ,col="skyblue", lwd = 1) +
geom_function(fun = curva_ajustada_B, aes(linetype = "Insecticida B") ,col="green") +
geom_function(fun = curva_ajustada_C, aes(linetype = "Insecticida C") ,col="darkblue", lwd = 0.8)+ theme_bw()
View(datna)
ggplot(datos, aes(Deposit, p_Killed)) +
geom_line() +
geom_function(fun = curva_ajustada_A, aes(linetype = "Insecticida A") ,col="skyblue", lwd = 1) +
geom_function(fun = curva_ajustada_B, aes(linetype = "Insecticida B") ,col="green") +
geom_function(fun = curva_ajustada_C, aes(linetype = "Insecticida C") ,col="darkblue", lwd = 0.8)+ theme_bw()
ggplot(datos, aes(Deposit, p_Killed)) +
geom_point() +
geom_function(fun = curva_ajustada_A, aes(linetype = "Insecticida A") ,col="skyblue", lwd = 1) +
geom_function(fun = curva_ajustada_B, aes(linetype = "Insecticida B") ,col="green") +
geom_function(fun = curva_ajustada_C, aes(linetype = "Insecticida C") ,col="darkblue", lwd = 0.8)+ theme_bw()
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed, colour="coral" )) +
geom_point(aes(y = prob_s, colour="deepskyblue")) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
newdata <- data.frame(Insecticide = c("A", "A","A","A", "A","A","B","B", "B", "B","B", "B","C","C", "C", "C","C", "C"), lnD = c(0.6931472, 0.9707789, 1.2470323,1.5238800, 1.8017098, 2.0794415, 0.6931472, 0.9707789, 1.2470323,1.5238800, 1.8017098, 2.0794415, 0.6931472, 0.9707789, 1.2470323,1.5238800, 1.8017098, 2.0794415), lnD2 = c(0.4804530, 0.9424117, 1.5550895,2.32221, 3.246158, 4.32407, 0.4804530, 0.9424117, 1.5550895,2.32221, 3.246158, 4.32407, 0.4804530, 0.9424117, 1.5550895,2.32221, 3.246158, 4.32407) )
newdata$prob_s <- predict(fitprob_s, newdata[,1:3], type = c("response"), se.fit=TRUE)$fit
newdata$Deposit<-exp(newdata$lnD)
#kable(newdata)
newdata1<- newdata[,-c(1,5)]
datosfin<-cbind(datos,newdata1)
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed, colour="coral" )) +
geom_point(aes(y = prob_s, colour="deepskyblue")) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed, colour="coral" )) +
geom_line(aes(y = prob_s, colour="deepskyblue")) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
View(datosfin)
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed, colour="coral" )) +
geom_line(aes(x=Deposit, y = prob_s, colour="deepskyblue")) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(data = datosfin[A], aes(x = Deposit))+
geom_point(aes(y = p_Killed, colour="coral" )) +
geom_line(aes(y = prob_s, colour="deepskyblue")) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(data = datosfin["A"], aes(x = Deposit))+
geom_point(aes(y = p_Killed, colour="coral" )) +
geom_line(aes(y = prob_s, colour="deepskyblue")) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed, colour="coral" )) +
geom_line(aes(y = prob_s, colour="deepskyblue")) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed, colour="coral" )) +
geom_point(aes(y = prob_s, colour="deepskyblue")) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed)) +
geom_point(aes(y = prob_s)) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed)) +
geom_line(aes(y = prob_s), by=Insecticide) +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(data = datosfin, aes(x = Deposit))+
geom_point(aes(y = p_Killed)) +
geom_line(aes(y = prob_s), by="Insecticide") +
scale_y_continuous(sec.axis = sec_axis(~ .*1,  name="probit")) + theme_bw()
ggplot(datos, aes(Deposit, p_Killed)) +
geom_line() +
geom_function(fun = curva_ajustada_A, aes(linetype = "Insecticida A") ,col="skyblue", lwd = 1) +
geom_function(fun = curva_ajustada_B, aes(linetype = "Insecticida B") ,col="green") +
geom_function(fun = curva_ajustada_C, aes(linetype = "Insecticida C") ,col="darkblue", lwd = 0.8)+ theme_bw()
ggplot(datos, aes(Deposit, p_Killed)) +
geom_point() +
geom_function(fun = curva_ajustada_A, aes(linetype = "Insecticida A") ,col="skyblue", lwd = 1) +
geom_function(fun = curva_ajustada_B, aes(linetype = "Insecticida B") ,col="green") +
geom_function(fun = curva_ajustada_C, aes(linetype = "Insecticida C") ,col="darkblue", lwd = 0.8)+ theme_bw()
